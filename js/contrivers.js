!function(a,b){"use strict";function c(){this.nodes=[],this.eqsLength=0,this.widths=[],this.points=[],this.callback=void 0}function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(){return c.call(a,window.event)})}"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__===String.prototype?function(a){return a.__proto__}:function(a){return a.constructor.prototype});for(var e=0,f=["webkit","moz"],g=0;g<f.length&&!window.requestAnimationFrame;++g)window.requestAnimationFrame=window[f[g]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[f[g]+"CancelAnimationFrame"]||window[f[g]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,b){b=b;var c=(new Date).getTime(),d=Math.max(0,16-(c-e)),f=window.setTimeout(function(){a(c+d)},d);return e=c+d,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),c.prototype.query=function(b,c){var d,e=Object.getPrototypeOf(a);c&&"function"==typeof c&&(e.callback=c),b&&"number"!=typeof b?d=b.length:(b=e.nodes,d=e.nodesLength);var f,g=[],h=[];for(f=0;d>f;f++){g.push(b[f].offsetWidth);try{h.push(e.sortObj(b[f].getAttribute("data-eq-pts")))}catch(i){h.push({})}}e.widths=g,e.points=h,b&&"number"!=typeof b?e.nodeWrites(b,g,h):c&&"function"!=typeof c?e.nodeWrites():window.requestAnimationFrame(e.nodeWrites)},c.prototype.nodeWrites=function(b){var c,d,e,f=Object.getPrototypeOf(a),g=f.widths,h=f.points;for(b&&"number"!=typeof b?d=b.length:(b=f.nodes,d=f.nodesLength),c=0;d>c;c++){var i=g[c],j=b[c],k=h[c],l=k.length;if(i<k[0].value)j.removeAttribute("data-eq-state");else if(i>=k[l-1].value)j.setAttribute("data-eq-state",k[l-1].key);else for(var m=0;l>m;m++){var n=k[m],o=k[m+1];if(0===m&&i<n.value){j.removeAttribute("data-eq-state");break}if(void 0===o.value){j.setAttribute("data-eq-state",o.key);break}if(i>=n.value&&i<o.value){j.setAttribute("data-eq-state",n.key);break}}}f.callback&&(e=f.callback,f.callback=void 0,e(b))},c.prototype.refreshNodes=function(){var b=Object.getPrototypeOf(a);b.nodes=document.querySelectorAll("[data-eq-pts]"),b.nodesLength=b.nodes.length},c.prototype.sortObj=function(a){for(var b=[],c=a.split(","),d=0;d<c.length;d++){var e=c[d].split(":");b.push({key:e[0].replace(/^\s+|\s+$/g,""),value:parseFloat(e[1])})}return b.sort(function(a,b){return a.value-b.value})},a=a||new c,b?b(function(){a.refreshNodes(),a.query(void 0,!0)}):d(window,"DOMContentLoaded",function(){a.refreshNodes(),a.query(void 0,!0)}),d(window,"resize",function(){a.refreshNodes(),window.requestAnimationFrame(a.query)}),"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.eqjs=a}(window.eqjs,window.domready),function(w,d){"use strict";var srcsetSupported="srcset"in document.createElement("img"),Viewport=function(){this.width=w.innerWidth||d.documentElement.clientWidth,this.height=w.innerHeight||d.documentElement.clientHeight,this.pixelRatio=w.devicePixelRatio||1},SrcSet=function(viewport){this.viewport=viewport,this.maxWidth=1/0,this.maxHeight=1/0,this.maxPixelRatio=1,this.candidates=[]};SrcSet.prototype={constructor:SrcSet,parseImage:function(img){var rSrc=/[^\s]+/,rHeight=/\s(\d+)h/,rWidth=/\s(\d+)w/,rRatio=/\s(\d+((\.\d+)?))x/,srcset=img.getAttribute("srcset"),candidates=this.candidates;if(srcset){var i,sources=srcset.split(","),length=sources.length;for(i=0;length>i;i+=1){var src=sources[i].match(rSrc)[0],height=rHeight.test(sources[i])?parseInt(sources[i].match(rHeight)[1],10):1/0,width=rWidth.test(sources[i])?parseInt(sources[i].match(rWidth)[1],10):1/0,pixelRatio=rRatio.test(sources[i])?parseFloat(sources[i].match(rRatio)[1]):1;candidates.push({src:src,height:height,width:width,pixelRatio:pixelRatio})}}return this},getBestCandidate:function(viewport){var images=this.candidates,width=viewport.width,height=viewport.height,pixelRatio=viewport.pixelRatio,getBestCandidate=function(criteria){var i,length=images.length,best=images[0];for(i=0;length>i;i+=1)criteria(images[i],best)&&(best=images[i]);return best},removeCandidate=function(criteria){var i,length=images.length;for(i=length-1;i>=0;i-=1)criteria(images[i])&&images.splice(i,1)};if(0===images.length)return null;var largestWidth=getBestCandidate(function(a,b){return a.width>b.width});removeCandidate(function(a){return a.width<width}),0===images.length&&(images=[largestWidth]);var largestHeight=getBestCandidate(function(a,b){return a.height>b.height});removeCandidate(function(a){return a.height<height}),0===images.length&&(images=[largestHeight]);var largestPixelRatio=getBestCandidate(function(a,b){return a.pixelRatio>b.pixelRatio});removeCandidate(function(a){return a.pixelRatio<pixelRatio}),0===images.length&&(images=[largestPixelRatio]);var smallestWidth=getBestCandidate(function(a,b){return a.width<b.width});removeCandidate(function(a){return a.width>smallestWidth.width});var smallestHeight=getBestCandidate(function(a,b){return a.height<b.height});removeCandidate(function(a){return a.height>smallestHeight.height});var smallestPixelRatio=getBestCandidate(function(a,b){return a.pixelRatio<b.pixelRatio});return removeCandidate(function(a){return a.pixelRatio>smallestPixelRatio.pixelRatio}),images[0]}};var resizeTimer,setSources=function(){if(!srcsetSupported){var i,viewport=new Viewport,images=document.querySelectorAll("img"),length=images.length;for(i=0;length>i;i+=1){var srcSet=new SrcSet,image=images[i],candidate=srcSet.parseImage(image).getBestCandidate(viewport);candidate&&(image.src=candidate.src)}}},addEventHandler=function(eventType,handler){w.addEventListener?w.addEventListener(eventType,handler,!1):w.attachEvent&&"DOMContentLoaded"!==eventType&&w.attachEvent("on"+eventType,handler)};addEventHandler("DOMContentLoaded",function(){setSources(),w.removeEventListener("load",setSources,!1)}),addEventHandler("load",setSources),addEventHandler("resize",function(){resizeTimer&&w.clearTimeout(resizeTimer),resizeTimer=w.setTimeout(setSources,50)}),w.srcset=setSources}(window,document),!function(a,b,c){"use strict";var d=function(d,e){var f=!!b.getComputedStyle;f||(b.getComputedStyle=function(a){return this.el=a,this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"===b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this});var g,h,i,j,k,l,m=function(a,b,c,d){if("addEventListener"in a)try{a.addEventListener(b,c,d)}catch(e){if("object"!=typeof c||!c.handleEvent)throw e;a.addEventListener(b,function(a){c.handleEvent.call(c,a)},d)}else"attachEvent"in a&&("object"==typeof c&&c.handleEvent?a.attachEvent("on"+b,function(){c.handleEvent.call(c)}):a.attachEvent("on"+b,c))},n=function(a,b,c,d){if("removeEventListener"in a)try{a.removeEventListener(b,c,d)}catch(e){if("object"!=typeof c||!c.handleEvent)throw e;a.removeEventListener(b,function(a){c.handleEvent.call(c,a)},d)}else"detachEvent"in a&&("object"==typeof c&&c.handleEvent?a.detachEvent("on"+b,function(){c.handleEvent.call(c)}):a.detachEvent("on"+b,c))},o=function(a){if(a.children.length<1)throw new Error("The Nav container has no containing elements");for(var b=[],c=0;c<a.children.length;c++)1===a.children[c].nodeType&&b.push(a.children[c]);return b},p=function(a,b){for(var c in b)a.setAttribute(c,b[c])},q=function(a,b){0!==a.className.indexOf(b)&&(a.className+=" "+b,a.className=a.className.replace(/(^\s*)|(\s*$)/g,""))},r=function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ").replace(/(^\s*)|(\s*$)/g,"")},s=function(a,b,c){for(var d=0;d<a.length;d++)b.call(c,d,a[d])},t=a.createElement("style"),u=a.documentElement,v=function(b,c){var d;this.options={animate:!0,transition:284,label:"Menu",insert:"before",customToggle:"",closeOnNavClick:!1,openPos:"relative",navClass:"nav-collapse",navActiveClass:"js-nav-active",jsClass:"js",init:function(){},open:function(){},close:function(){}};for(d in c)this.options[d]=c[d];if(q(u,this.options.jsClass),this.wrapperEl=b.replace("#",""),a.getElementById(this.wrapperEl))this.wrapper=a.getElementById(this.wrapperEl);else{if(!a.querySelector(this.wrapperEl))throw new Error("The nav element you are trying to select doesn't exist");this.wrapper=a.querySelector(this.wrapperEl)}this.wrapper.inner=o(this.wrapper),h=this.options,g=this.wrapper,this._init(this)};return v.prototype={destroy:function(){this._removeStyles(),r(g,"closed"),r(g,"opened"),r(g,h.navClass),r(g,h.navClass+"-"+this.index),r(u,h.navActiveClass),g.removeAttribute("style"),g.removeAttribute("aria-hidden"),n(b,"resize",this,!1),n(a.body,"touchmove",this,!1),n(i,"touchstart",this,!1),n(i,"touchend",this,!1),n(i,"mouseup",this,!1),n(i,"keyup",this,!1),n(i,"click",this,!1),h.customToggle?i.removeAttribute("aria-hidden"):i.parentNode.removeChild(i)},toggle:function(){j===!0&&(l?this.close():this.open())},open:function(){l||(r(g,"closed"),q(g,"opened"),q(u,h.navActiveClass),q(i,"active"),g.style.position=h.openPos,p(g,{"aria-hidden":"false"}),l=!0,h.open())},close:function(){l&&(q(g,"closed"),r(g,"opened"),r(u,h.navActiveClass),r(i,"active"),p(g,{"aria-hidden":"true"}),h.animate?(j=!1,setTimeout(function(){g.style.position="absolute",j=!0},h.transition+10)):g.style.position="absolute",l=!1,h.close())},resize:function(){"none"!==b.getComputedStyle(i,null).getPropertyValue("display")?(k=!0,p(i,{"aria-hidden":"false"}),g.className.match(/(^|\s)closed(\s|$)/)&&(p(g,{"aria-hidden":"true"}),g.style.position="absolute"),this._createStyles(),this._calcHeight()):(k=!1,p(i,{"aria-hidden":"true"}),p(g,{"aria-hidden":"false"}),g.style.position=h.openPos,this._removeStyles())},handleEvent:function(a){var c=a||b.event;switch(c.type){case"touchstart":this._onTouchStart(c);break;case"touchmove":this._onTouchMove(c);break;case"touchend":case"mouseup":this._onTouchEnd(c);break;case"click":this._preventDefault(c);break;case"keyup":this._onKeyUp(c);break;case"resize":this.resize(c)}},_init:function(){this.index=c++,q(g,h.navClass),q(g,h.navClass+"-"+this.index),q(g,"closed"),j=!0,l=!1,this._closeOnNavClick(),this._createToggle(),this._transitions(),this.resize();var d=this;setTimeout(function(){d.resize()},20),m(b,"resize",this,!1),m(a.body,"touchmove",this,!1),m(i,"touchstart",this,!1),m(i,"touchend",this,!1),m(i,"mouseup",this,!1),m(i,"keyup",this,!1),m(i,"click",this,!1),h.init()},_createStyles:function(){t.parentNode||(t.type="text/css",a.getElementsByTagName("head")[0].appendChild(t))},_removeStyles:function(){t.parentNode&&t.parentNode.removeChild(t)},_createToggle:function(){if(h.customToggle){var b=h.customToggle.replace("#","");if(a.getElementById(b))i=a.getElementById(b);else{if(!a.querySelector(b))throw new Error("The custom nav toggle you are trying to select doesn't exist");i=a.querySelector(b)}}else{var c=a.createElement("a");c.innerHTML=h.label,p(c,{href:"#","class":"nav-toggle"}),"after"===h.insert?g.parentNode.insertBefore(c,g.nextSibling):g.parentNode.insertBefore(c,g),i=c}},_closeOnNavClick:function(){if(h.closeOnNavClick&&"querySelectorAll"in a){var b=g.querySelectorAll("a"),c=this;s(b,function(a){m(b[a],"click",function(){k&&c.toggle()},!1)})}},_preventDefault:function(a){a.preventDefault?(a.preventDefault(),a.stopPropagation()):a.returnValue=!1},_onTouchStart:function(b){b.stopPropagation(),"after"===h.insert&&q(a.body,"disable-pointer-events"),this.startX=b.touches[0].clientX,this.startY=b.touches[0].clientY,this.touchHasMoved=!1,n(i,"mouseup",this,!1)},_onTouchMove:function(a){(Math.abs(a.touches[0].clientX-this.startX)>10||Math.abs(a.touches[0].clientY-this.startY)>10)&&(this.touchHasMoved=!0)},_onTouchEnd:function(c){if(this._preventDefault(c),!this.touchHasMoved){if("touchend"===c.type)return this.toggle(),void("after"===h.insert&&setTimeout(function(){r(a.body,"disable-pointer-events")},h.transition+300));var d=c||b.event;3!==d.which&&2!==d.button&&this.toggle()}},_onKeyUp:function(a){var c=a||b.event;13===c.keyCode&&this.toggle()},_transitions:function(){if(h.animate){var a=g.style,b="max-height "+h.transition+"ms";a.WebkitTransition=b,a.MozTransition=b,a.OTransition=b,a.transition=b}},_calcHeight:function(){for(var a=0,b=0;b<g.inner.length;b++)a+=g.inner[b].offsetHeight;var c="."+h.jsClass+" ."+h.navClass+"-"+this.index+".opened{max-height:"+a+"px !important}";t.styleSheet?t.styleSheet.cssText=c:t.innerHTML=c,c=""}},new v(d,e)};b.responsiveNav=d}(document,window,0);var nav=responsiveNav(".nav-collapse",{label:"<i class='fa fa-bars fa-3x  menu-toggle'></i>"});!function(){if(window.jQuery){var is_inline=function(){return"inline"==$(".article-aside").attr("data-eq-state")?(console.log("Article nav should be inline."),!0):"stack"==$(".article-aside").attr("data-eq-state")?(console.log("Article nav should be stacked."),!1):void console.log("Something went wrong with eqjs.")},responsiveMenuToggle=function(){$(".article-aside .submenu").hide(),$(".article-aside .has-submenu").hoverIntent(function(){$(".submenu",this).toggle()}),is_inline()?($(".menu-toggle").hide(),$(".article-aside-navbar").show()):($(".menu-toggle").show(),$(".article-aside-navbar").hide()),$(".menu-toggle").click(function(){$(".article-aside-navbar").toggle()})};$(window).load(function(){responsiveMenuToggle()}),$(window).resize(function(){is_inline()?($(".menu-toggle").hide(),$(".article-aside-navbar").show()):($(".menu-toggle").show(),$(".article-aside-navbar").hide())})}}(),function($){$.fn.hoverIntent=function(handlerIn,handlerOut,selector){var cfg={interval:100,sensitivity:6,timeout:0};cfg="object"==typeof handlerIn?$.extend(cfg,handlerIn):$.isFunction(handlerOut)?$.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector}):$.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut});var cX,cY,pX,pY,track=function(ev){cX=ev.pageX,cY=ev.pageY},compare=function(ev,ob){return ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t),Math.sqrt((pX-cX)*(pX-cX)+(pY-cY)*(pY-cY))<cfg.sensitivity?($(ob).off("mousemove.hoverIntent",track),ob.hoverIntent_s=!0,cfg.over.apply(ob,[ev])):(pX=cX,pY=cY,ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval),void 0)},delay=function(ev,ob){return ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t),ob.hoverIntent_s=!1,cfg.out.apply(ob,[ev])},handleHover=function(e){var ev=$.extend({},e),ob=this;ob.hoverIntent_t&&(ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)),"mouseenter"===e.type?(pX=ev.pageX,pY=ev.pageY,$(ob).on("mousemove.hoverIntent",track),ob.hoverIntent_s||(ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval))):($(ob).off("mousemove.hoverIntent",track),ob.hoverIntent_s&&(ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)))};return this.on({"mouseenter.hoverIntent":handleHover,"mouseleave.hoverIntent":handleHover},cfg.selector)}}(jQuery),function(){!function($){return $.bigfoot=function(options){var addBreakpoint,baseFontSize,bigfoot,buttonHover,calculatePixelDimension,cleanFootnoteLinks,clickButton,createPopover,defaults,deleteEmptyOrHR,escapeKeypress,footnoteInit,getSetting,makeDefaultCallbacks,popoverStates,positionTooltip,removeBackLinks,removeBreakpoint,removePopovers,replaceWithReferenceAttributes,repositionFeet,roomCalc,settings,touchClick,unhoverFeet,updateSetting,viewportDetails;return bigfoot=void 0,defaults={actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,anchorParentTagname:"sup",breakpoints:{},deleteOnUnhover:!1,footnoteParentClass:"footnote",footnoteTagname:"li",hoverDelay:250,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:'<aside class="bigfoot-footnote is-positioned-bottom" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"> <div class="bigfoot-footnote__wrapper"> <div class="bigfoot-footnote__content"> {{FOOTNOTECONTENT}} </div></div> <div class="bigfoot-footnote__tooltip"></div> </aside>',buttonMarkup:'<div class=\'bigfoot-footnote__container\'> <button class="bigfoot-footnote__button" id="{{SUP:data-footnote-backlink-ref}}" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote" data-bigfoot-footnote="{{FOOTNOTECONTENT}}"> <svg class="bigfoot-footnote__button__circle" viewbox="0 0 6 6" preserveAspectRatio="xMinYMin"><circle r="3" cx="3" cy="3" fill="white"></circle></svg> <svg class="bigfoot-footnote__button__circle" viewbox="0 0 6 6" preserveAspectRatio="xMinYMin"><circle r="3" cx="3" cy="3" fill="white"></circle></svg> <svg class="bigfoot-footnote__button__circle" viewbox="0 0 6 6" preserveAspectRatio="xMinYMin"><circle r="3" cx="3" cy="3" fill="white"></circle></svg> </button></div>'},settings=$.extend(defaults,options),popoverStates={},footnoteInit=function(){var $curResetElement,$currentLastFootnoteLink,$footnoteAnchors,$footnoteButton,$lastResetElement,$parent,$relevantFNLink,$relevantFootnote,finalFNLinks,footnoteButton,footnoteButtonSearchQuery,footnoteContent,footnoteIDNum,footnoteLinks,footnoteNum,footnotes,i,_i,_ref,_results;for(footnoteButtonSearchQuery=settings.scope?""+settings.scope+' a[href*="#"]':'a[href*="#"]',$footnoteAnchors=$(footnoteButtonSearchQuery).filter(function(){var $this,relAttr;return $this=$(this),relAttr=$this.attr("rel"),("null"===relAttr||null==relAttr)&&(relAttr=""),(""+$this.attr("href")+relAttr).match(settings.anchorPattern)&&$this.closest("[class*="+settings.footnoteParentClass+"]:not(a):not("+settings.anchorParentTagname+")").length<1}),footnotes=[],footnoteLinks=[],finalFNLinks=[],cleanFootnoteLinks($footnoteAnchors,footnoteLinks),$(footnoteLinks).each(function(){var $closestFootnoteEl,relatedFN;return relatedFN=$(this).data("footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&"),settings.useFootnoteOnlyOnce&&(relatedFN=""+relatedFN+":not(.footnote-processed)"),$closestFootnoteEl=$(relatedFN).closest(settings.footnoteTagname),$closestFootnoteEl.length>0?(footnotes.push($closestFootnoteEl.first().addClass("footnote-processed")),finalFNLinks.push(this)):void 0}),$currentLastFootnoteLink=$("[data-footnote-identifier]:last"),footnoteIDNum=$currentLastFootnoteLink.length<1?0:+$currentLastFootnoteLink.data("footnote-identifier"),_results=[],i=_i=0,_ref=footnotes.length;_ref>=0?_ref>_i:_i>_ref;i=_ref>=0?++_i:--_i)switch(footnoteContent=removeBackLinks($(footnotes[i]).html().trim(),$(finalFNLinks[i]).data("footnote-backlink-ref")),footnoteContent=footnoteContent.replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),footnoteIDNum+=1,footnoteButton="",$relevantFNLink=$(finalFNLinks[i]),$relevantFootnote=$(footnotes[i]),null!=settings.numberResetSelector?($curResetElement=$relevantFNLink.closest(settings.numberResetSelector),$curResetElement.is($lastResetElement)?footnoteNum+=1:footnoteNum=1,$lastResetElement=$curResetElement):footnoteNum=footnoteIDNum,0!==footnoteContent.indexOf("<")&&(footnoteContent="<p>"+footnoteContent+"</p>"),footnoteButton=settings.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,footnoteNum).replace(/\{\{FOOTNOTEID\}\}/g,footnoteIDNum).replace(/\{\{FOOTNOTECONTENT\}\}/g,footnoteContent),footnoteButton=replaceWithReferenceAttributes(footnoteButton,"SUP",$relevantFNLink),footnoteButton=replaceWithReferenceAttributes(footnoteButton,"FN",$relevantFootnote),$footnoteButton=$(footnoteButton).insertBefore($relevantFNLink),$parent=$relevantFootnote.parent(),settings.actionOriginalFN.toLowerCase()){case"hide":$relevantFNLink.addClass("footnote-print-only"),$relevantFootnote.addClass("footnote-print-only"),_results.push(deleteEmptyOrHR($parent));break;case"delete":$relevantFNLink.remove(),$relevantFootnote.remove(),_results.push(deleteEmptyOrHR($parent));break;default:_results.push($relevantFNLink.addClass("footnote-print-only"))}return _results},cleanFootnoteLinks=function($footnoteAnchors,footnoteLinks){var $parent,$supChild,linkHREF,linkID;null==footnoteLinks&&(footnoteLinks=[]),$parent=void 0,$supChild=void 0,linkHREF=void 0,linkID=void 0,$footnoteAnchors.each(function(){var $child,$this;return $this=$(this),linkHREF="#"+$this.attr("href").split("#")[1],$parent=$this.closest(settings.anchorParentTagname),$child=$this.find(settings.anchorParentTagname),$parent.length>0?(linkID=($parent.attr("id")||"")+($this.attr("id")||""),footnoteLinks.push($parent.attr({"data-footnote-backlink-ref":linkID,"data-footnote-ref":linkHREF}))):$child.length>0?(linkID=($child.attr("id")||"")+($this.attr("id")||""),footnoteLinks.push($this.attr({"data-footnote-backlink-ref":linkID,"data-footnote-ref":linkHREF}))):(linkID=$this.attr("id")||"",footnoteLinks.push($this.attr({"data-footnote-backlink-ref":linkID,"data-footnote-ref":linkHREF})))})},deleteEmptyOrHR=function($el){var $parent;return $parent=void 0,$el.is(":empty")||0===$el.children(":not(.footnote-print-only)").length?($parent=$el.parent(),"delete"===settings.actionOriginalFN.toLowerCase()?$el.remove():$el.addClass("footnote-print-only"),deleteEmptyOrHR($parent)):$el.children(":not(.footnote-print-only)").length===$el.children("hr:not(.footnote-print-only)").length?($parent=$el.parent(),"delete"===settings.actionOriginalFN.toLowerCase()?$el.remove():($el.children("hr").addClass("footnote-print-only"),$el.addClass("footnote-print-only")),deleteEmptyOrHR($parent)):void 0},removeBackLinks=function(footnoteHTML,backlinkID){var regex;return backlinkID.indexOf(" ")>=0&&(backlinkID=backlinkID.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),regex=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+backlinkID+"[^>]*>(.*?)<\\s*/\\s*a>","g"),footnoteHTML.replace(regex,"").replace("[]","")},replaceWithReferenceAttributes=function(string,referenceKeyword,$referenceElement){var refMatches,refRegex,refReplaceRegex,refReplaceText;for(refRegex=new RegExp("\\{\\{"+referenceKeyword+":([^\\}]*)\\}\\}","g"),refMatches=void 0,refReplaceText=void 0,refReplaceRegex=void 0,refMatches=refRegex.exec(string);refMatches;)refMatches[1]&&(refReplaceText=$referenceElement.attr(refMatches[1])||"",string=string.replace("{{"+referenceKeyword+":"+refMatches[1]+"}}",refReplaceText)),refMatches=refRegex.exec(string);return string},buttonHover=function(event){var $buttonHovered,dataIdentifier,otherPopoverSelector;if(settings.activateOnHover){if($buttonHovered=$(event.target).closest(".bigfoot-footnote__button"),dataIdentifier='[data-footnote-identifier="'+$buttonHovered.attr("data-footnote-identifier")+'"]',$buttonHovered.hasClass("is-active"))return;$buttonHovered.addClass("is-hover-instantiated"),settings.allowMultipleFN||(otherPopoverSelector=".bigfoot-footnote:not("+dataIdentifier+")",removePopovers(otherPopoverSelector)),createPopover(".bigfoot-footnote__button"+dataIdentifier).addClass("is-hover-instantiated")}},touchClick=function(event){var $nearButton,$nearFootnote,$target;$target=$(event.target),$nearButton=$target.closest(".bigfoot-footnote__button"),$nearFootnote=$target.closest(".bigfoot-footnote"),$nearButton.length>0?(event.preventDefault(),clickButton($nearButton)):$nearFootnote.length<1&&$(".bigfoot-footnote").length>0&&removePopovers()},clickButton=function($button){var dataIdentifier;$button.blur(),dataIdentifier='data-footnote-identifier="'+$button.attr("data-footnote-identifier")+'"',$button.hasClass("changing")||($button.hasClass("is-active")?settings.allowMultipleFN?removePopovers(".bigfoot-footnote["+dataIdentifier+"]"):removePopovers():($button.addClass("changing"),setTimeout(function(){return $button.removeClass("changing")},settings.popoverCreateDelay),createPopover(".bigfoot-footnote__button["+dataIdentifier+"]"),$button.addClass("is-click-instantiated"),settings.allowMultipleFN||removePopovers(".bigfoot-footnote:not(["+dataIdentifier+"])")))},createPopover=function(selector){var $buttons,$popoversCreated;return $buttons=void 0,$buttons="string"!=typeof selector&&settings.allowMultipleFN?selector:"string"!=typeof selector?selector.first():settings.allowMultipleFN?$(selector).closest(".bigfoot-footnote__button"):$(selector+":first").closest(".bigfoot-footnote__button"),$popoversCreated=$(),$buttons.each(function(){var $content,$contentContainer,$this,content;$this=$(this),content=void 0;try{return content=settings.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,$this.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,$this.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,$this.attr("data-bigfoot-footnote")).replace(/\&gtsym\;/g,"&gt;").replace(/\&ltsym\;/g,"&lt;"),content=replaceWithReferenceAttributes(content,"BUTTON",$this)}finally{$content=$(content);try{settings.activateCallback($content,$this)}catch(_error){}$content.insertAfter($buttons),popoverStates[$this.attr("data-footnote-identifier")]="init",$content.attr("bigfoot-max-width",calculatePixelDimension($content.css("max-width"),$content)),$content.css("max-width",1e4),$contentContainer=$content.find(".bigfoot-footnote__content"),$content.attr("data-bigfoot-max-height",calculatePixelDimension($contentContainer.css("max-height"),$contentContainer)),repositionFeet(),$this.addClass("is-active"),$content.find(".bigfoot-footnote__content").bindScrollHandler(),$popoversCreated=$popoversCreated.add($content)}}),setTimeout(function(){return $popoversCreated.addClass("is-active")},settings.popoverCreateDelay),$popoversCreated},baseFontSize=function(){var el,size;return el=document.createElement("div"),el.style.cssText="display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;",el.appendChild(document.createElement("M")),document.body.appendChild(el),size=el.offsetHeight,document.body.removeChild(el),size},calculatePixelDimension=function(dim,$el){return"none"===dim?dim=1e4:dim.indexOf("rem")>=0?dim=parseFloat(dim)*baseFontSize():dim.indexOf("em")>=0?dim=parseFloat(dim)*parseFloat($el.css("font-size")):dim.indexOf("px")>=0?(dim=parseFloat(dim),60>=dim&&(dim/=parseFloat($el.parent().css("width")))):dim.indexOf("%")>=0&&(dim=parseFloat(dim)/100),dim},$.fn.bindScrollHandler=function(){return settings.preventPageScroll?($(this).on("DOMMouseScroll mousewheel",function(event){var $popover,$this,delta,height,prevent,scrollHeight,scrollTop,up;return $this=$(this),scrollTop=$this.scrollTop(),scrollHeight=$this[0].scrollHeight,height=parseInt($this.css("height")),$popover=$this.closest(".bigfoot-footnote"),$this.scrollTop()>0&&$this.scrollTop()<10&&$popover.addClass("is-scrollable"),$popover.hasClass("is-scrollable")?(delta="DOMMouseScroll"===event.type?-40*event.originalEvent.detail:event.originalEvent.wheelDelta,up=delta>0,prevent=function(){return event.stopPropagation(),event.preventDefault(),event.returnValue=!1,!1},!up&&-delta>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),$popover.addClass("is-fully-scrolled"),prevent()):up&&delta>scrollTop?($this.scrollTop(0),$popover.removeClass("is-fully-scrolled"),prevent()):$popover.removeClass("is-fully-scrolled")):void 0}),$(this)):$(this)},unhoverFeet=function(e){return settings.deleteOnUnhover&&settings.activateOnHover?setTimeout(function(){var $target;return $target=$(e.target).closest(".bigfoot-footnote, .bigfoot-footnote__button"),$(".bigfoot-footnote__button:hover, .bigfoot-footnote:hover").length<1?removePopovers():void 0},settings.hoverDelay):void 0},escapeKeypress=function(event){return 27===event.keyCode?removePopovers():void 0},removePopovers=function(footnotes,timeout){var $buttonsClosed,$linkedButton,$this,footnoteID;return null==footnotes&&(footnotes=".bigfoot-footnote"),null==timeout&&(timeout=settings.popoverDeleteDelay),$buttonsClosed=$(),footnoteID=void 0,$linkedButton=void 0,$this=void 0,$(footnotes).each(function(){return $this=$(this),footnoteID=$this.attr("data-footnote-identifier"),$linkedButton=$('.bigfoot-footnote__button[data-footnote-identifier="'+footnoteID+'"]'),$linkedButton.hasClass("changing")?void 0:($buttonsClosed=$buttonsClosed.add($linkedButton),$linkedButton.removeClass("is-active is-hover-instantiated is-click-instantiated").addClass("changing"),$this.removeClass("is-active").addClass("disapearing"),setTimeout(function(){return $this.remove(),delete popoverStates[footnoteID],$linkedButton.removeClass("changing")},timeout))}),$buttonsClosed},repositionFeet=function(e){var type;settings.positionContent&&(type=e?e.type:"resize",$(".bigfoot-footnote").each(function(){var $button,$contentWrapper,$mainWrap,$this,dataIdentifier,identifier,lastState,marginSize,maxHeightInCSS,maxHeightOnScreen,maxWidth,maxWidthInCSS,positionOnTop,relativeToWidth,roomLeft,totalHeight;return $this=$(this),identifier=$this.attr("data-footnote-identifier"),dataIdentifier='data-footnote-identifier="'+identifier+'"',$contentWrapper=$this.find(".bigfoot-footnote__content"),$button=$this.siblings(".bigfoot-footnote__button"),roomLeft=roomCalc($button),marginSize=parseFloat($this.css("margin-top")),maxHeightInCSS=+$this.attr("data-bigfoot-max-height"),totalHeight=2*marginSize+$this.outerHeight(),maxHeightOnScreen=1e4,positionOnTop=roomLeft.bottomRoom<totalHeight&&roomLeft.topRoom>roomLeft.bottomRoom,lastState=popoverStates[identifier],positionOnTop?("top"!==lastState&&(popoverStates[identifier]="top",$this.addClass("is-positioned-top").removeClass("is-positioned-bottom"),$this.css("transform-origin",100*roomLeft.leftRelative+"% 100%")),maxHeightOnScreen=roomLeft.topRoom-marginSize-15):(("bottom"!==lastState||"init"===lastState)&&(popoverStates[identifier]="bottom",$this.removeClass("is-positioned-top").addClass("is-positioned-bottom"),$this.css("transform-origin",100*roomLeft.leftRelative+"% 0%")),maxHeightOnScreen=roomLeft.bottomRoom-marginSize-15),$this.find(".bigfoot-footnote__content").css({"max-height":Math.min(maxHeightOnScreen,maxHeightInCSS)+"px"}),"resize"===type&&(maxWidthInCSS=parseFloat($this.attr("bigfoot-max-width")),$mainWrap=$this.find(".bigfoot-footnote__wrapper"),maxWidth=maxWidthInCSS,1>=maxWidthInCSS&&(relativeToWidth=function(){var jq,userSpecifiedRelativeElWidth;return userSpecifiedRelativeElWidth=1e4,settings.maxWidthRelativeTo&&(jq=$(settings.maxWidthRelativeTo),jq.length>0&&(userSpecifiedRelativeElWidth=jq.outerWidth())),Math.min(window.innerWidth,userSpecifiedRelativeElWidth)}(),maxWidth=relativeToWidth*maxWidthInCSS),maxWidth=Math.min(maxWidth,$this.find(".bigfoot-footnote__content").outerWidth()+1),$mainWrap.css("max-width",maxWidth+"px"),$this.css({left:-roomLeft.leftRelative*maxWidth+parseFloat($button.css("margin-left"))+$button.outerWidth()/2+"px"}),positionTooltip($this,roomLeft.leftRelative)),parseInt($this.outerHeight())<$this.find(".bigfoot-footnote__content")[0].scrollHeight?$this.addClass("is-scrollable"):void 0}))},positionTooltip=function($popover,leftRelative){var $tooltip;null==leftRelative&&(leftRelative=.5),$tooltip=$popover.find(".bigfoot-footnote__tooltip"),$tooltip.length>0&&$tooltip.css("left",""+100*leftRelative+"%")},roomCalc=function($el){var elHeight,elLeftMargin,elWidth,leftRoom,topRoom,w;return elLeftMargin=parseFloat($el.css("margin-left")),elWidth=parseFloat($el.outerWidth())-elLeftMargin,elHeight=parseFloat($el.outerHeight()),w=viewportDetails(),topRoom=$el.offset().top-w.scrollY+elHeight/2,leftRoom=$el.offset().left-w.scrollX+elWidth/2,{topRoom:topRoom,bottomRoom:w.height-topRoom,leftRoom:leftRoom,rightRoom:w.width-leftRoom,leftRelative:leftRoom/w.width,topRelative:topRoom/w.height}},viewportDetails=function(){return{width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY}},addBreakpoint=function(size,trueCallback,falseCallback,deleteDelay,removeOpen){var falseDefaultPositionSetting,minMax,mqListener,mql,query,s,trueDefaultPositionSetting;return null==deleteDelay&&(deleteDelay=settings.popoverDeleteDelay),null==removeOpen&&(removeOpen=!0),mql=void 0,minMax=void 0,s=void 0,"string"==typeof size?(s="iphone"===size.toLowerCase()?"<320px":"ipad"===size.toLowerCase()?"<768px":size,minMax=">"===s.charAt(0)?"min":"<"===s.charAt(0)?"max":null,query=minMax?"("+minMax+"-width: "+s.substring(1)+")":s,mql=window.matchMedia(query)):mql=size,mql.media&&"invalid"===mql.media?{added:!1,mq:mql,listener:null}:(trueDefaultPositionSetting="min"===minMax,falseDefaultPositionSetting="max"===minMax,trueCallback=trueCallback||makeDefaultCallbacks(removeOpen,deleteDelay,trueDefaultPositionSetting,function($popover){return $popover.addClass("is-bottom-fixed")
}),falseCallback=falseCallback||makeDefaultCallbacks(removeOpen,deleteDelay,falseDefaultPositionSetting,function(){}),mqListener=function(mq){mq.matches?trueCallback(removeOpen,bigfoot):falseCallback(removeOpen,bigfoot)},mql.addListener(mqListener),mqListener(mql),settings.breakpoints[size]={added:!0,mq:mql,listener:mqListener},settings.breakpoints[size])},makeDefaultCallbacks=function(removeOpen,deleteDelay,position,callback){return function(removeOpen,bigfoot){var $closedPopovers;return $closedPopovers=void 0,removeOpen&&($closedPopovers=bigfoot.close(),bigfoot.updateSetting("activateCallback",callback)),setTimeout(function(){return bigfoot.updateSetting("positionContent",position),removeOpen?bigfoot.activate($closedPopovers):void 0},deleteDelay)}},removeBreakpoint=function(target,callback){var b,breakpoint,mq,mqFound;if(mq=null,b=void 0,mqFound=!1,"string"==typeof target)mqFound=void 0!==settings.breakpoints[target];else for(b in settings.breakpoints)settings.breakpoints.hasOwnProperty(b)&&settings.breakpoints[b].mq===target&&(mqFound=!0);return mqFound&&(breakpoint=settings.breakpoints[b||target],callback?callback({matches:!1}):breakpoint.listener({matches:!1}),breakpoint.mq.removeListener(breakpoint.listener),delete settings.breakpoints[b||target]),mqFound},updateSetting=function(newSettings,value){var oldValue,prop;if(oldValue=void 0,"string"==typeof newSettings)oldValue=settings[newSettings],settings[newSettings]=value;else{oldValue={};for(prop in newSettings)newSettings.hasOwnProperty(prop)&&(oldValue[prop]=settings[prop],settings[prop]=newSettings[prop])}return oldValue},getSetting=function(setting){return settings[setting]},$(document).ready(function(){return footnoteInit(),$(document).on("mouseenter",".bigfoot-footnote__button",buttonHover),$(document).on("touchend click",touchClick),$(document).on("mouseout",".is-hover-instantiated",unhoverFeet),$(document).on("keyup",escapeKeypress),$(window).on("scroll resize",repositionFeet),$(document).on("gestureend",function(){return repositionFeet()})}),bigfoot={removePopovers:removePopovers,close:removePopovers,createPopover:createPopover,activate:createPopover,repositionFeet:repositionFeet,reposition:repositionFeet,addBreakpoint:addBreakpoint,removeBreakpoint:removeBreakpoint,getSetting:getSetting,updateSetting:updateSetting}}}(jQuery)}.call(this);